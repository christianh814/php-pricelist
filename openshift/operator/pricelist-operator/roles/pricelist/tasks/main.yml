---
# tasks file for pricelist
- name: Create database storage
  k8s:
    state: present
    definition: "{{ lookup('template', 'pricelist-db-pvc.yaml.j2') }}"

- name: Create database deployment
  k8s:
    state: present
    definition: "{{ lookup('template', 'pricelist-db.yaml.j2') }}"

- name: Create database service
  k8s:
    state: present
    definition: "{{ lookup('template', 'pricelist-db-svc.yaml.j2') }}"

- name: Create frontend deployment
  k8s:
    state: present
    definition: "{{ lookup('template', 'pricelist-deploy.yaml.j2') }}"

- name: Create frontend service
  k8s:
    state: present
    definition: "{{ lookup('template', 'pricelist-svc.yaml.j2') }}"

- name: Wait for DB to come up
  pause:
    seconds: 20

- name: Create postrun job
  k8s:
    state: present
    definition: "{{ lookup('template', 'pricelist-job.yaml.j2') }}"
